# Elevetor_tracker_website

## 概要
- **背景**: 私の通っている専門学校のエレベータは今どこの階に何人乗っているのかがわからないどのくらい待てば到着するのかがわからないそういった問題がありました。<br>
- **解決策**: Raspi + AI(YOLO) で状況を解析し、MQTT/WebSocketでリアルタイム配信。
- **特徴**: データの蓄積による利用傾向の分析機能。

## システム構成図
後で作ります。

## イメージ動作
後で貼ります。

## 手順
- セットアップは、setup.shを動かせば、セットアップされます。
    - 具体的なセットアップは、以下のとおりです。
      * 必要な環境やモジュールなどのインストール
      * .envファイルの作成
      * DBのユーザーネーム パスワード データベース名
      * DBの作成
      * pythonとreactの環境構築
      * ufwによるポート開放(80ポート)
    ```bash
        bash setup.sh
    ```   
- run.shを実行してください。そうすれば動くはず
    - 実施内容
      * バックエンドとフロントエンドの起動
    ```bash
        bash run.sh
    ```

- export_run.shを実行するとexport_dataというフォルダー内にCSVファイルでDBのデータが保存されます。
    
    ```bash
        bash export_run.sh
    ```

## 技術スタック
- バックエンド
    * python
    * mysql
    * bash
    * fastapi # API設定
    * uvicorn # web用非同期サーバー
    * sqlalchemy # DBを使うためのモジュール
    * pydantic
    * pydantic-settings
    * python-dotenv # envを読み込むためのモジュール
    * aiomysql # Mysql接続用
    * paho-mqtt # MQTTクライアント接続用
    * cryptography # 暗号化など
    * websockets # 双方通信用モジュール
    * broker.hivemq.com
- フロントエンド
    * react/typescript

## 開発者が学んだこと

<details>
<summary> 長過ぎるから折りたたむ </summary>

これでpythonの一つ前のディレクトリのファイルを参照できる

``` python
import os
import sys
# 1. 自分のいる場所（appフォルダ）の絶対パスを取得
current_dir = os.path.dirname(os.path.abspath(__file__))
# 2. 一つ上の階層（親フォルダ）のパスを作る
parent_dir = os.path.dirname(current_dir)
# 3. Pythonの「探し物リスト」に親フォルダを追加！
sys.path.append(parent_dir)

```

* bashファイルで以下のことをすると解放しやすいらしい。

```bash
    # setsid を使うと新しいプロセスセッションを開始でき、グループ kill が確実になります
    setsid python app/workers/mqtt_worker.py > /dev/null 2>&1 &
```
### sqlを使うのが初めて

pythonでtableを作るシステムをつくったのは、馬鹿だった。<br>
普通にsqlファイルで作成しても良かったと思った。<br>
けどsqlファイルは、.envファイルを参照できないみたいだから、環境設定をあらかじめつくっておくシステムを作るには不向きかもしれん。<br>結局sqlファイルはどのタイミングで使用するのがいいのかがまだわかってないね。正直ファイル出力をするならbashファイルでいい。<br>
つかbashファイルが便利すぎる。けど辛いことにbashはlinuxでしか使うことができないのが辛いよね。<br>
javaでbashファイルみたいに、環境構築だったりとか作ることってできるのかな。<br>

### websocketは中継システム
バイブコーディンをして出てきたからなんとなく使用してたけど、これすごい技術だね<br>
バックグランドが用意している変数を、フロントエンドやクライアントがアクセスすることで利用できるシステムなんだね。<br>

### DBよくわかんないし、バイブコーディングは怖いね
ほぼ、バイブコーディングで、イメージはできるけど、これをすべて自分がまた書ける自信はないよね。<br>
あと、概念を理解できていないままバイブコーディンをすると何が書いてあるのかが一切わからなくなる問題がある<br>
DBを初めてつくったけど、なかなか難しいぞどこまでを、入れるのかがね。<br>
DB構成を考えるのは、なかなかニーズがないと難しいね<br>

### .envファイルはプッシュしてはいけない。
プッシュしていいのは、.env.exsampleという雛形に落とし込む。<br>
なんとなく、「学生がつくったgithubなんて誰も見ないだろう」と思ってセキュリティど外しでやったらgeminiに怒られたのと、学生のうちから、セキュリティ意識を持っておくのは大事かなと思って、色々書き換えました。<br>
地獄だったのは、gitの履歴とファイルを消すってなったときに、ローカルファイルも消えてしまってびっくり。<br>
てっきりgithubの情報だけが消えると勘違いしていて、.envファイルのバックアップを取っていないままままコマンドを実行したもんだから、.envファイルが全部消えて、DBの情報を思い出すのにちょっと大変だった。<br>
githubの勉強もしないといけないなと勉強になった<br>
そのあとも、.envファイル内でちょっときになったところを修正したらもちろんpythonのソースコードも修正しないといけないわけで、<br>
あれやこれやしてたら、websocketがいかれて萎えたよね。<br>
しかも途中全然webの画面が表示されなくなってしまって、直すのに奮闘してた。<br>
結局ソースコードの問題ではなくブラウザを変えたら、写ったので開発中にブラウザがIPとポートをブラックリストに登録されてしまったかもしれん。<br>


### 初めてのweb開発でreactを使うのは危なすぎる
reactは複雑なので、先にHTML+CSS+JavaScriptを使ったwebサイトを作ってイメージを固めたほうがいいと思った。<br>
今までしっかりとしたフロントエンドを組んだことがなくつながりをイメージできないままつくっていくのは、危険だと思った。保守性が足りない。<br>

</details>

## 導入したい技術スタック

<ul>
    <li><b>SORACOM (SORACOM Beam/Canal)</b>：
日本のIoTで超定番！SIMカードと一緒に使うと、セキュリティ設定を肩代わりしてくれるから、デバイス側の負担が減ってすごく楽ちんだよ。
    <li><b>AWS IoT Core / Azure IoT Hub</b>：
世界中で使われている超巨大な郵便局。将来的にデバイスが何万台に増えても大丈夫な、とっても頼れるサービスだよ。
    <li><b>HiveMQ Cloud / Shiftr.io</b>：
「まずは手軽に試したい！」という時にぴったりな、設定が簡単なクラウド型ブローカーだよ。
</ul>

## 実際に導入した技術スタック

* SORACOM (SORACOM Beam/Canal)

## ライセンス/開発者
- web,DB,backend開発者: ayappy-mugicha
- 
